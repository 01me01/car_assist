<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
<div class="page-container">

  <!-- Top Bar -->
  <div class="dashboard-top">
    <a class="back-btn" href="{{ url_for('home') }}">‚Üê Back to Customer Form</a>
    <h1>Workshop Admin Dashboard</h1>
  </div>

  <!-- Stats Cards -->
  <div class="stats-row">
    
    <!-- Total Requests -->
    <div class="stat-box">
      <div class="stat-text">
        <div class="stat-title">Total Requests</div>
        <div class="stat-number">{{ total }}</div>
        <div class="stat-updated">updated just now</div>
      </div>

      <div class="stat-icon">
        <!-- Clipboard list icon -->
        <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m-.75-12H9.75A2.25 2.25 0 007.5 6.75v10.5A2.25 2.25 0 009.75 19.5h4.5A2.25 2.25 0 0016.5 17.25V6.75A2.25 2.25 0 0014.25 4.5z" />
        </svg>
      </div>
    </div>

    <!-- Categories -->
    <div class="stat-box">
      <div class="stat-text">
        <div class="stat-title">Categories Found</div>
        <div class="stat-number">{{ rows|length }}</div>
        <div class="stat-updated">AI classified</div>
      </div>
      <div class="stat-icon">
        <!-- Chart icon -->
        <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 3v18h18M7 13h2v5H7zm5-6h2v11h-2zm5 8h2v3h-2z" />
        </svg>
      </div>
    </div>

    <!-- High Priority -->
    <div class="stat-box">
      <div class="stat-text">
        <div class="stat-title">High Priority</div>
        <div class="stat-number">
          {{ rows | selectattr('predicted_priority', 'equalto', 'High') | list | length }}
        </div>
        <div class="stat-updated">urgent cases</div>
      </div>
      <div class="stat-icon">
        <!-- Flag icon -->
        <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 3v18m0-16h8l-2 3 2 3H6" />
        </svg>
      </div>
    </div>

    <!-- Avg Hours
    <div class="stat-box">
      <div class="stat-text">
        <div class="stat-title">Avg Hours</div>
        <div class="stat-number">
          {{ rows | map(attribute='predicted_hours') | sum / (rows|length) | round(1) }}
        </div>
        <div class="stat-updated">AI estimation</div>
      </div> -->
      <!-- <div class="stat-icon">
     Clock icon -->
        <!-- <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
    </div> --> 

  </div>

  <!-- Charts -->
  <div class="chart-row">
    <div class="chart-card">
      <h3>Requests per Category</h3>
      <img id="categoryChart" src="{{ url_for('static', filename='charts/category.png') }}" width="100%">
    </div>

    <div class="chart-card">
      <h3>Requests per Priority</h3>
      <img id="priorityChart" src="{{ url_for('static', filename='charts/priority.png') }}" width="100%">
    </div>
  </div>

  <!-- Recent Table -->
  <div class="table-wrapper" style="margin-top:30px;">
    <h3>Recent Requests</h3>
    <table>
      <tr>
        <th>ID</th><th>Name</th><th>Category</th><th>Priority</th><th>Hours</th><th>Created</th>
      </tr>
      {% for r in rows %}
      <tr>
        <td>{{ r['id'] }}</td>
        <td>{{ r['name'] }}</td>
        <td>{{ r['predicted_category'] }}</td>
        <td>{{ r['predicted_priority'] }}</td>
        <td>{{ r['predicted_hours'] }}</td>
        <td>{{ r['created_at'] }}</td>
      </tr>
      {% endfor %}
    </table>
  </div>

</div>

<script>
function refreshCharts() {
    const t = new Date().getTime()
    document.getElementById("categoryChart").src =
      "{{ url_for('static', filename='charts/category.png') }}?v=" + t;
    document.getElementById("priorityChart").src =
      "{{ url_for('static', filename='charts/priority.png') }}?v=" + t;
}
setInterval(refreshCharts, 180000);
</script>

</body>
</html>
